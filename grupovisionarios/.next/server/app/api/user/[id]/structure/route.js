"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/user/[id]/structure/route";
exports.ids = ["app/api/user/[id]/structure/route"];
exports.modules = {

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@prisma/client");

/***/ }),

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "assert":
/*!*************************!*\
  !*** external "assert" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("assert");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "querystring":
/*!******************************!*\
  !*** external "querystring" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("querystring");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fuser%2F%5Bid%5D%2Fstructure%2Froute&page=%2Fapi%2Fuser%2F%5Bid%5D%2Fstructure%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fuser%2F%5Bid%5D%2Fstructure%2Froute.ts&appDir=C%3A%5Cgrupo-visionarios%5Cgrupovisionarios%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5Cgrupo-visionarios%5Cgrupovisionarios&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fuser%2F%5Bid%5D%2Fstructure%2Froute&page=%2Fapi%2Fuser%2F%5Bid%5D%2Fstructure%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fuser%2F%5Bid%5D%2Fstructure%2Froute.ts&appDir=C%3A%5Cgrupo-visionarios%5Cgrupovisionarios%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5Cgrupo-visionarios%5Cgrupovisionarios&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_grupo_visionarios_grupovisionarios_src_app_api_user_id_structure_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/user/[id]/structure/route.ts */ \"(rsc)/./src/app/api/user/[id]/structure/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/user/[id]/structure/route\",\n        pathname: \"/api/user/[id]/structure\",\n        filename: \"route\",\n        bundlePath: \"app/api/user/[id]/structure/route\"\n    },\n    resolvedPagePath: \"C:\\\\grupo-visionarios\\\\grupovisionarios\\\\src\\\\app\\\\api\\\\user\\\\[id]\\\\structure\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_grupo_visionarios_grupovisionarios_src_app_api_user_id_structure_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/user/[id]/structure/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZ1c2VyJTJGJTVCaWQlNUQlMkZzdHJ1Y3R1cmUlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRnVzZXIlMkYlNUJpZCU1RCUyRnN0cnVjdHVyZSUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRnVzZXIlMkYlNUJpZCU1RCUyRnN0cnVjdHVyZSUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDZ3J1cG8tdmlzaW9uYXJpb3MlNUNncnVwb3Zpc2lvbmFyaW9zJTVDc3JjJTVDYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj1DJTNBJTVDZ3J1cG8tdmlzaW9uYXJpb3MlNUNncnVwb3Zpc2lvbmFyaW9zJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUN1QztBQUNwSDtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL2dydXBvdmlzaW9uYXJpb3MvP2JjNzkiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiQzpcXFxcZ3J1cG8tdmlzaW9uYXJpb3NcXFxcZ3J1cG92aXNpb25hcmlvc1xcXFxzcmNcXFxcYXBwXFxcXGFwaVxcXFx1c2VyXFxcXFtpZF1cXFxcc3RydWN0dXJlXFxcXHJvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS91c2VyL1tpZF0vc3RydWN0dXJlL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvdXNlci9baWRdL3N0cnVjdHVyZVwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvdXNlci9baWRdL3N0cnVjdHVyZS9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIkM6XFxcXGdydXBvLXZpc2lvbmFyaW9zXFxcXGdydXBvdmlzaW9uYXJpb3NcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxcdXNlclxcXFxbaWRdXFxcXHN0cnVjdHVyZVxcXFxyb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvdXNlci9baWRdL3N0cnVjdHVyZS9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fuser%2F%5Bid%5D%2Fstructure%2Froute&page=%2Fapi%2Fuser%2F%5Bid%5D%2Fstructure%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fuser%2F%5Bid%5D%2Fstructure%2Froute.ts&appDir=C%3A%5Cgrupo-visionarios%5Cgrupovisionarios%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5Cgrupo-visionarios%5Cgrupovisionarios&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/user/[id]/structure/route.ts":
/*!**************************************************!*\
  !*** ./src/app/api/user/[id]/structure/route.ts ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var next_auth_next__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next-auth/next */ \"(rsc)/./node_modules/next-auth/next/index.js\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/auth */ \"(rsc)/./src/lib/auth.ts\");\n/* harmony import */ var _lib_multilevel_system__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/multilevel-system */ \"(rsc)/./src/lib/multilevel-system.ts\");\n\n\n\n\nasync function GET(request, { params }) {\n    try {\n        const session = await (0,next_auth_next__WEBPACK_IMPORTED_MODULE_1__.getServerSession)(_lib_auth__WEBPACK_IMPORTED_MODULE_2__.authOptions);\n        if (!session?.user?.id) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"No autorizado\"\n            }, {\n                status: 401\n            });\n        }\n        const userId = params.id;\n        const { searchParams } = new URL(request.url);\n        const maxDepth = parseInt(searchParams.get(\"depth\") || \"3\");\n        const includeInactive = searchParams.get(\"includeInactive\") === \"true\";\n        // Check if user has permission to view this structure\n        if (session.user.id !== userId && session.user.role !== \"admin\") {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"No tienes permisos para ver esta estructura\"\n            }, {\n                status: 403\n            });\n        }\n        // Get the complete referral structure\n        const structure = await (0,_lib_multilevel_system__WEBPACK_IMPORTED_MODULE_3__.getUserReferralStructure)(userId, maxDepth);\n        if (!structure) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Usuario no encontrado\"\n            }, {\n                status: 404\n            });\n        }\n        // Calculate structure statistics\n        const calculateStats = (node)=>{\n            const directCount = node.directReferrals.length;\n            let totalCount = directCount;\n            let activeCount = node.directReferrals.filter((r)=>r.isActive).length;\n            let totalDepth = 0;\n            for (const child of node.directReferrals){\n                const childStats = calculateStats(child);\n                totalCount += childStats.total;\n                activeCount += childStats.active;\n                totalDepth = Math.max(totalDepth, childStats.depth + 1);\n            }\n            return {\n                direct: directCount,\n                total: totalCount,\n                active: activeCount,\n                depth: totalDepth\n            };\n        };\n        const stats = calculateStats(structure);\n        // Check 3x3 structure validation\n        const validateStructure = (node)=>{\n            const directReferrals = node.directReferrals || [];\n            const hasThreeDirects = directReferrals.length >= 3;\n            let directsWithThree = 0;\n            if (hasThreeDirects) {\n                for(let i = 0; i < Math.min(3, directReferrals.length); i++){\n                    const childDirects = directReferrals[i].directReferrals?.length || 0;\n                    if (childDirects >= 3) {\n                        directsWithThree++;\n                    }\n                }\n            }\n            const isValid3x3 = hasThreeDirects && directsWithThree >= 3;\n            return {\n                hasThreeDirects,\n                directsWithThree,\n                isValid3x3\n            };\n        };\n        const structureValidation = validateStructure(structure);\n        // Format response\n        const responseData = {\n            success: true,\n            user: {\n                id: structure.id,\n                name: structure.name,\n                email: structure.email,\n                level: structure.level,\n                isActive: structure.isActive,\n                joinDate: structure.joinDate\n            },\n            structure: structure.directReferrals,\n            statistics: {\n                directReferrals: stats.direct,\n                totalReferrals: stats.total,\n                activeReferrals: stats.active,\n                maxDepth: stats.depth,\n                ...structureValidation\n            },\n            validation: {\n                canPromote: structureValidation.isValid3x3,\n                requirements: {\n                    directReferrals: {\n                        required: 3,\n                        current: stats.direct,\n                        met: stats.direct >= 3\n                    },\n                    secondLevelReferrals: {\n                        required: 3,\n                        current: structureValidation.directsWithThree,\n                        met: structureValidation.directsWithThree >= 3\n                    }\n                }\n            }\n        };\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(responseData);\n    } catch (error) {\n        console.error(\"Error in GET /api/user/[id]/structure:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Error interno del servidor\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS91c2VyL1tpZF0vc3RydWN0dXJlL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQXVEO0FBQ047QUFDVDtBQUMwQjtBQUUzRCxlQUFlSSxJQUNwQkMsT0FBb0IsRUFDcEIsRUFBRUMsTUFBTSxFQUE4QjtJQUV0QyxJQUFJO1FBQ0YsTUFBTUMsVUFBVSxNQUFNTixnRUFBZ0JBLENBQUNDLGtEQUFXQTtRQUVsRCxJQUFJLENBQUNLLFNBQVNDLE1BQU1DLElBQUk7WUFDdEIsT0FBT1QscURBQVlBLENBQUNVLElBQUksQ0FDdEI7Z0JBQUVDLE9BQU87WUFBZ0IsR0FDekI7Z0JBQUVDLFFBQVE7WUFBSTtRQUVsQjtRQUVBLE1BQU1DLFNBQVNQLE9BQU9HLEVBQUU7UUFDeEIsTUFBTSxFQUFFSyxZQUFZLEVBQUUsR0FBRyxJQUFJQyxJQUFJVixRQUFRVyxHQUFHO1FBQzVDLE1BQU1DLFdBQVdDLFNBQVNKLGFBQWFLLEdBQUcsQ0FBQyxZQUFZO1FBQ3ZELE1BQU1DLGtCQUFrQk4sYUFBYUssR0FBRyxDQUFDLHVCQUF1QjtRQUVoRSxzREFBc0Q7UUFDdEQsSUFBSVosUUFBUUMsSUFBSSxDQUFDQyxFQUFFLEtBQUtJLFVBQVVOLFFBQVFDLElBQUksQ0FBQ2EsSUFBSSxLQUFLLFNBQVM7WUFDL0QsT0FBT3JCLHFEQUFZQSxDQUFDVSxJQUFJLENBQ3RCO2dCQUFFQyxPQUFPO1lBQThDLEdBQ3ZEO2dCQUFFQyxRQUFRO1lBQUk7UUFFbEI7UUFFQSxzQ0FBc0M7UUFDdEMsTUFBTVUsWUFBWSxNQUFNbkIsZ0ZBQXdCQSxDQUFDVSxRQUFRSTtRQUV6RCxJQUFJLENBQUNLLFdBQVc7WUFDZCxPQUFPdEIscURBQVlBLENBQUNVLElBQUksQ0FDdEI7Z0JBQUVDLE9BQU87WUFBd0IsR0FDakM7Z0JBQUVDLFFBQVE7WUFBSTtRQUVsQjtRQUVBLGlDQUFpQztRQUNqQyxNQUFNVyxpQkFBaUIsQ0FBQ0M7WUFDdEIsTUFBTUMsY0FBY0QsS0FBS0UsZUFBZSxDQUFDQyxNQUFNO1lBQy9DLElBQUlDLGFBQWFIO1lBQ2pCLElBQUlJLGNBQWNMLEtBQUtFLGVBQWUsQ0FBQ0ksTUFBTSxDQUFDLENBQUNDLElBQVdBLEVBQUVDLFFBQVEsRUFBRUwsTUFBTTtZQUM1RSxJQUFJTSxhQUFhO1lBRWpCLEtBQUssTUFBTUMsU0FBU1YsS0FBS0UsZUFBZSxDQUFFO2dCQUN4QyxNQUFNUyxhQUFhWixlQUFlVztnQkFDbENOLGNBQWNPLFdBQVdDLEtBQUs7Z0JBQzlCUCxlQUFlTSxXQUFXRSxNQUFNO2dCQUNoQ0osYUFBYUssS0FBS0MsR0FBRyxDQUFDTixZQUFZRSxXQUFXSyxLQUFLLEdBQUc7WUFDdkQ7WUFFQSxPQUFPO2dCQUNMQyxRQUFRaEI7Z0JBQ1JXLE9BQU9SO2dCQUNQUyxRQUFRUjtnQkFDUlcsT0FBT1A7WUFDVDtRQUNGO1FBRUEsTUFBTVMsUUFBUW5CLGVBQWVEO1FBRTdCLGlDQUFpQztRQUNqQyxNQUFNcUIsb0JBQW9CLENBQUNuQjtZQUt6QixNQUFNRSxrQkFBa0JGLEtBQUtFLGVBQWUsSUFBSSxFQUFFO1lBQ2xELE1BQU1rQixrQkFBa0JsQixnQkFBZ0JDLE1BQU0sSUFBSTtZQUVsRCxJQUFJa0IsbUJBQW1CO1lBQ3ZCLElBQUlELGlCQUFpQjtnQkFDbkIsSUFBSyxJQUFJRSxJQUFJLEdBQUdBLElBQUlSLEtBQUtTLEdBQUcsQ0FBQyxHQUFHckIsZ0JBQWdCQyxNQUFNLEdBQUdtQixJQUFLO29CQUM1RCxNQUFNRSxlQUFldEIsZUFBZSxDQUFDb0IsRUFBRSxDQUFDcEIsZUFBZSxFQUFFQyxVQUFVO29CQUNuRSxJQUFJcUIsZ0JBQWdCLEdBQUc7d0JBQ3JCSDtvQkFDRjtnQkFDRjtZQUNGO1lBRUEsTUFBTUksYUFBYUwsbUJBQW1CQyxvQkFBb0I7WUFFMUQsT0FBTztnQkFDTEQ7Z0JBQ0FDO2dCQUNBSTtZQUNGO1FBQ0Y7UUFFQSxNQUFNQyxzQkFBc0JQLGtCQUFrQnJCO1FBRTlDLGtCQUFrQjtRQUNsQixNQUFNNkIsZUFBZTtZQUNuQkMsU0FBUztZQUNUNUMsTUFBTTtnQkFDSkMsSUFBSWEsVUFBVWIsRUFBRTtnQkFDaEI0QyxNQUFNL0IsVUFBVStCLElBQUk7Z0JBQ3BCQyxPQUFPaEMsVUFBVWdDLEtBQUs7Z0JBQ3RCQyxPQUFPakMsVUFBVWlDLEtBQUs7Z0JBQ3RCdkIsVUFBVVYsVUFBVVUsUUFBUTtnQkFDNUJ3QixVQUFVbEMsVUFBVWtDLFFBQVE7WUFDOUI7WUFDQWxDLFdBQVdBLFVBQVVJLGVBQWU7WUFDcEMrQixZQUFZO2dCQUNWL0IsaUJBQWlCZ0IsTUFBTUQsTUFBTTtnQkFDN0JpQixnQkFBZ0JoQixNQUFNTixLQUFLO2dCQUMzQnVCLGlCQUFpQmpCLE1BQU1MLE1BQU07Z0JBQzdCcEIsVUFBVXlCLE1BQU1GLEtBQUs7Z0JBQ3JCLEdBQUdVLG1CQUFtQjtZQUN4QjtZQUNBVSxZQUFZO2dCQUNWQyxZQUFZWCxvQkFBb0JELFVBQVU7Z0JBQzFDYSxjQUFjO29CQUNacEMsaUJBQWlCO3dCQUNmcUMsVUFBVTt3QkFDVkMsU0FBU3RCLE1BQU1ELE1BQU07d0JBQ3JCd0IsS0FBS3ZCLE1BQU1ELE1BQU0sSUFBSTtvQkFDdkI7b0JBQ0F5QixzQkFBc0I7d0JBQ3BCSCxVQUFVO3dCQUNWQyxTQUFTZCxvQkFBb0JMLGdCQUFnQjt3QkFDN0NvQixLQUFLZixvQkFBb0JMLGdCQUFnQixJQUFJO29CQUMvQztnQkFDRjtZQUNGO1FBQ0Y7UUFFQSxPQUFPN0MscURBQVlBLENBQUNVLElBQUksQ0FBQ3lDO0lBRTNCLEVBQUUsT0FBT3hDLE9BQU87UUFDZHdELFFBQVF4RCxLQUFLLENBQUMsMENBQTBDQTtRQUN4RCxPQUFPWCxxREFBWUEsQ0FBQ1UsSUFBSSxDQUN0QjtZQUFFQyxPQUFPO1FBQTZCLEdBQ3RDO1lBQUVDLFFBQVE7UUFBSTtJQUVsQjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZ3J1cG92aXNpb25hcmlvcy8uL3NyYy9hcHAvYXBpL3VzZXIvW2lkXS9zdHJ1Y3R1cmUvcm91dGUudHM/NDRlNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5pbXBvcnQgeyBnZXRTZXJ2ZXJTZXNzaW9uIH0gZnJvbSAnbmV4dC1hdXRoL25leHQnXG5pbXBvcnQgeyBhdXRoT3B0aW9ucyB9IGZyb20gJ0AvbGliL2F1dGgnXG5pbXBvcnQgeyBnZXRVc2VyUmVmZXJyYWxTdHJ1Y3R1cmUgfSBmcm9tICdAL2xpYi9tdWx0aWxldmVsLXN5c3RlbSdcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChcbiAgcmVxdWVzdDogTmV4dFJlcXVlc3QsXG4gIHsgcGFyYW1zIH06IHsgcGFyYW1zOiB7IGlkOiBzdHJpbmcgfSB9XG4pIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgZ2V0U2VydmVyU2Vzc2lvbihhdXRoT3B0aW9ucylcbiAgICBcbiAgICBpZiAoIXNlc3Npb24/LnVzZXI/LmlkKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdObyBhdXRvcml6YWRvJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAxIH1cbiAgICAgIClcbiAgICB9XG5cbiAgICBjb25zdCB1c2VySWQgPSBwYXJhbXMuaWRcbiAgICBjb25zdCB7IHNlYXJjaFBhcmFtcyB9ID0gbmV3IFVSTChyZXF1ZXN0LnVybClcbiAgICBjb25zdCBtYXhEZXB0aCA9IHBhcnNlSW50KHNlYXJjaFBhcmFtcy5nZXQoJ2RlcHRoJykgfHwgJzMnKVxuICAgIGNvbnN0IGluY2x1ZGVJbmFjdGl2ZSA9IHNlYXJjaFBhcmFtcy5nZXQoJ2luY2x1ZGVJbmFjdGl2ZScpID09PSAndHJ1ZSdcblxuICAgIC8vIENoZWNrIGlmIHVzZXIgaGFzIHBlcm1pc3Npb24gdG8gdmlldyB0aGlzIHN0cnVjdHVyZVxuICAgIGlmIChzZXNzaW9uLnVzZXIuaWQgIT09IHVzZXJJZCAmJiBzZXNzaW9uLnVzZXIucm9sZSAhPT0gJ2FkbWluJykge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnTm8gdGllbmVzIHBlcm1pc29zIHBhcmEgdmVyIGVzdGEgZXN0cnVjdHVyYScgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICApXG4gICAgfVxuXG4gICAgLy8gR2V0IHRoZSBjb21wbGV0ZSByZWZlcnJhbCBzdHJ1Y3R1cmVcbiAgICBjb25zdCBzdHJ1Y3R1cmUgPSBhd2FpdCBnZXRVc2VyUmVmZXJyYWxTdHJ1Y3R1cmUodXNlcklkLCBtYXhEZXB0aClcblxuICAgIGlmICghc3RydWN0dXJlKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdVc3VhcmlvIG5vIGVuY29udHJhZG8nIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDQgfVxuICAgICAgKVxuICAgIH1cblxuICAgIC8vIENhbGN1bGF0ZSBzdHJ1Y3R1cmUgc3RhdGlzdGljc1xuICAgIGNvbnN0IGNhbGN1bGF0ZVN0YXRzID0gKG5vZGU6IGFueSk6IGFueSA9PiB7XG4gICAgICBjb25zdCBkaXJlY3RDb3VudCA9IG5vZGUuZGlyZWN0UmVmZXJyYWxzLmxlbmd0aFxuICAgICAgbGV0IHRvdGFsQ291bnQgPSBkaXJlY3RDb3VudFxuICAgICAgbGV0IGFjdGl2ZUNvdW50ID0gbm9kZS5kaXJlY3RSZWZlcnJhbHMuZmlsdGVyKChyOiBhbnkpID0+IHIuaXNBY3RpdmUpLmxlbmd0aFxuICAgICAgbGV0IHRvdGFsRGVwdGggPSAwXG5cbiAgICAgIGZvciAoY29uc3QgY2hpbGQgb2Ygbm9kZS5kaXJlY3RSZWZlcnJhbHMpIHtcbiAgICAgICAgY29uc3QgY2hpbGRTdGF0cyA9IGNhbGN1bGF0ZVN0YXRzKGNoaWxkKVxuICAgICAgICB0b3RhbENvdW50ICs9IGNoaWxkU3RhdHMudG90YWxcbiAgICAgICAgYWN0aXZlQ291bnQgKz0gY2hpbGRTdGF0cy5hY3RpdmVcbiAgICAgICAgdG90YWxEZXB0aCA9IE1hdGgubWF4KHRvdGFsRGVwdGgsIGNoaWxkU3RhdHMuZGVwdGggKyAxKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBkaXJlY3Q6IGRpcmVjdENvdW50LFxuICAgICAgICB0b3RhbDogdG90YWxDb3VudCxcbiAgICAgICAgYWN0aXZlOiBhY3RpdmVDb3VudCxcbiAgICAgICAgZGVwdGg6IHRvdGFsRGVwdGhcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBzdGF0cyA9IGNhbGN1bGF0ZVN0YXRzKHN0cnVjdHVyZSlcblxuICAgIC8vIENoZWNrIDN4MyBzdHJ1Y3R1cmUgdmFsaWRhdGlvblxuICAgIGNvbnN0IHZhbGlkYXRlU3RydWN0dXJlID0gKG5vZGU6IGFueSk6IHtcbiAgICAgIGhhc1RocmVlRGlyZWN0czogYm9vbGVhblxuICAgICAgZGlyZWN0c1dpdGhUaHJlZTogbnVtYmVyXG4gICAgICBpc1ZhbGlkM3gzOiBib29sZWFuXG4gICAgfSA9PiB7XG4gICAgICBjb25zdCBkaXJlY3RSZWZlcnJhbHMgPSBub2RlLmRpcmVjdFJlZmVycmFscyB8fCBbXVxuICAgICAgY29uc3QgaGFzVGhyZWVEaXJlY3RzID0gZGlyZWN0UmVmZXJyYWxzLmxlbmd0aCA+PSAzXG4gICAgICBcbiAgICAgIGxldCBkaXJlY3RzV2l0aFRocmVlID0gMFxuICAgICAgaWYgKGhhc1RocmVlRGlyZWN0cykge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE1hdGgubWluKDMsIGRpcmVjdFJlZmVycmFscy5sZW5ndGgpOyBpKyspIHtcbiAgICAgICAgICBjb25zdCBjaGlsZERpcmVjdHMgPSBkaXJlY3RSZWZlcnJhbHNbaV0uZGlyZWN0UmVmZXJyYWxzPy5sZW5ndGggfHwgMFxuICAgICAgICAgIGlmIChjaGlsZERpcmVjdHMgPj0gMykge1xuICAgICAgICAgICAgZGlyZWN0c1dpdGhUaHJlZSsrXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGlzVmFsaWQzeDMgPSBoYXNUaHJlZURpcmVjdHMgJiYgZGlyZWN0c1dpdGhUaHJlZSA+PSAzXG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGhhc1RocmVlRGlyZWN0cyxcbiAgICAgICAgZGlyZWN0c1dpdGhUaHJlZSxcbiAgICAgICAgaXNWYWxpZDN4M1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHN0cnVjdHVyZVZhbGlkYXRpb24gPSB2YWxpZGF0ZVN0cnVjdHVyZShzdHJ1Y3R1cmUpXG5cbiAgICAvLyBGb3JtYXQgcmVzcG9uc2VcbiAgICBjb25zdCByZXNwb25zZURhdGEgPSB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgdXNlcjoge1xuICAgICAgICBpZDogc3RydWN0dXJlLmlkLFxuICAgICAgICBuYW1lOiBzdHJ1Y3R1cmUubmFtZSxcbiAgICAgICAgZW1haWw6IHN0cnVjdHVyZS5lbWFpbCxcbiAgICAgICAgbGV2ZWw6IHN0cnVjdHVyZS5sZXZlbCxcbiAgICAgICAgaXNBY3RpdmU6IHN0cnVjdHVyZS5pc0FjdGl2ZSxcbiAgICAgICAgam9pbkRhdGU6IHN0cnVjdHVyZS5qb2luRGF0ZVxuICAgICAgfSxcbiAgICAgIHN0cnVjdHVyZTogc3RydWN0dXJlLmRpcmVjdFJlZmVycmFscyxcbiAgICAgIHN0YXRpc3RpY3M6IHtcbiAgICAgICAgZGlyZWN0UmVmZXJyYWxzOiBzdGF0cy5kaXJlY3QsXG4gICAgICAgIHRvdGFsUmVmZXJyYWxzOiBzdGF0cy50b3RhbCxcbiAgICAgICAgYWN0aXZlUmVmZXJyYWxzOiBzdGF0cy5hY3RpdmUsXG4gICAgICAgIG1heERlcHRoOiBzdGF0cy5kZXB0aCxcbiAgICAgICAgLi4uc3RydWN0dXJlVmFsaWRhdGlvblxuICAgICAgfSxcbiAgICAgIHZhbGlkYXRpb246IHtcbiAgICAgICAgY2FuUHJvbW90ZTogc3RydWN0dXJlVmFsaWRhdGlvbi5pc1ZhbGlkM3gzLFxuICAgICAgICByZXF1aXJlbWVudHM6IHtcbiAgICAgICAgICBkaXJlY3RSZWZlcnJhbHM6IHtcbiAgICAgICAgICAgIHJlcXVpcmVkOiAzLFxuICAgICAgICAgICAgY3VycmVudDogc3RhdHMuZGlyZWN0LFxuICAgICAgICAgICAgbWV0OiBzdGF0cy5kaXJlY3QgPj0gM1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2Vjb25kTGV2ZWxSZWZlcnJhbHM6IHtcbiAgICAgICAgICAgIHJlcXVpcmVkOiAzLFxuICAgICAgICAgICAgY3VycmVudDogc3RydWN0dXJlVmFsaWRhdGlvbi5kaXJlY3RzV2l0aFRocmVlLFxuICAgICAgICAgICAgbWV0OiBzdHJ1Y3R1cmVWYWxpZGF0aW9uLmRpcmVjdHNXaXRoVGhyZWUgPj0gM1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihyZXNwb25zZURhdGEpXG5cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBHRVQgL2FwaS91c2VyL1tpZF0vc3RydWN0dXJlOicsIGVycm9yKVxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgZXJyb3I6ICdFcnJvciBpbnRlcm5vIGRlbCBzZXJ2aWRvcicgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgIClcbiAgfVxufSAiXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiZ2V0U2VydmVyU2Vzc2lvbiIsImF1dGhPcHRpb25zIiwiZ2V0VXNlclJlZmVycmFsU3RydWN0dXJlIiwiR0VUIiwicmVxdWVzdCIsInBhcmFtcyIsInNlc3Npb24iLCJ1c2VyIiwiaWQiLCJqc29uIiwiZXJyb3IiLCJzdGF0dXMiLCJ1c2VySWQiLCJzZWFyY2hQYXJhbXMiLCJVUkwiLCJ1cmwiLCJtYXhEZXB0aCIsInBhcnNlSW50IiwiZ2V0IiwiaW5jbHVkZUluYWN0aXZlIiwicm9sZSIsInN0cnVjdHVyZSIsImNhbGN1bGF0ZVN0YXRzIiwibm9kZSIsImRpcmVjdENvdW50IiwiZGlyZWN0UmVmZXJyYWxzIiwibGVuZ3RoIiwidG90YWxDb3VudCIsImFjdGl2ZUNvdW50IiwiZmlsdGVyIiwiciIsImlzQWN0aXZlIiwidG90YWxEZXB0aCIsImNoaWxkIiwiY2hpbGRTdGF0cyIsInRvdGFsIiwiYWN0aXZlIiwiTWF0aCIsIm1heCIsImRlcHRoIiwiZGlyZWN0Iiwic3RhdHMiLCJ2YWxpZGF0ZVN0cnVjdHVyZSIsImhhc1RocmVlRGlyZWN0cyIsImRpcmVjdHNXaXRoVGhyZWUiLCJpIiwibWluIiwiY2hpbGREaXJlY3RzIiwiaXNWYWxpZDN4MyIsInN0cnVjdHVyZVZhbGlkYXRpb24iLCJyZXNwb25zZURhdGEiLCJzdWNjZXNzIiwibmFtZSIsImVtYWlsIiwibGV2ZWwiLCJqb2luRGF0ZSIsInN0YXRpc3RpY3MiLCJ0b3RhbFJlZmVycmFscyIsImFjdGl2ZVJlZmVycmFscyIsInZhbGlkYXRpb24iLCJjYW5Qcm9tb3RlIiwicmVxdWlyZW1lbnRzIiwicmVxdWlyZWQiLCJjdXJyZW50IiwibWV0Iiwic2Vjb25kTGV2ZWxSZWZlcnJhbHMiLCJjb25zb2xlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/user/[id]/structure/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/auth.ts":
/*!*************************!*\
  !*** ./src/lib/auth.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authOptions: () => (/* binding */ authOptions),\n/* harmony export */   getServerAuthSession: () => (/* binding */ getServerAuthSession)\n/* harmony export */ });\n/* harmony import */ var next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth/providers/credentials */ \"(rsc)/./node_modules/next-auth/providers/credentials.js\");\n/* harmony import */ var _next_auth_prisma_adapter__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @next-auth/prisma-adapter */ \"(rsc)/./node_modules/@next-auth/prisma-adapter/dist/index.js\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! bcryptjs */ \"(rsc)/./node_modules/bcryptjs/index.js\");\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/prisma */ \"(rsc)/./src/lib/prisma.ts\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! next-auth */ \"(rsc)/./node_modules/next-auth/index.js\");\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(next_auth__WEBPACK_IMPORTED_MODULE_4__);\n\n\n\n\nconst authOptions = {\n    adapter: (0,_next_auth_prisma_adapter__WEBPACK_IMPORTED_MODULE_1__.PrismaAdapter)(_lib_prisma__WEBPACK_IMPORTED_MODULE_3__.prisma),\n    session: {\n        strategy: \"jwt\"\n    },\n    pages: {\n        signIn: \"/auth/login\",\n        error: \"/auth/login\"\n    },\n    providers: [\n        (0,next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_0__[\"default\"])({\n            name: \"Credentials\",\n            credentials: {\n                email: {\n                    label: \"Correo\",\n                    type: \"email\",\n                    placeholder: \"correo@example.com\"\n                },\n                password: {\n                    label: \"Contrase\\xf1a\",\n                    type: \"password\"\n                }\n            },\n            async authorize (credentials) {\n                if (!credentials?.email || !credentials.password) {\n                    return null;\n                }\n                // Buscar usuario por email\n                const user = await _lib_prisma__WEBPACK_IMPORTED_MODULE_3__.prisma.user.findUnique({\n                    where: {\n                        email: credentials.email\n                    }\n                });\n                if (!user) return null;\n                const isValid = await (0,bcryptjs__WEBPACK_IMPORTED_MODULE_2__.compare)(credentials.password, user.password);\n                if (!isValid) return null;\n                return {\n                    id: user.id,\n                    email: user.email,\n                    name: user.name,\n                    role: user.role\n                };\n            }\n        })\n    ],\n    callbacks: {\n        async jwt ({ token, user }) {\n            if (user) {\n                token.role = user.role;\n            }\n            return token;\n        },\n        async session ({ session, token }) {\n            if (token && session.user) {\n                // Copiar información relevante del token a la sesión\n                session.user.role = token.role;\n                if (token.sub) {\n                    session.user.id = token.sub;\n                }\n                if (token.email) {\n                    session.user.email = token.email;\n                }\n            }\n            return session;\n        },\n        async redirect ({ url, baseUrl }) {\n            // After sign-in redirect according to role\n            if (url.startsWith(\"/\")) return url;\n            if (url.includes(\"/admin\")) return url;\n            return baseUrl;\n        }\n    },\n    secret: process.env.NEXTAUTH_SECRET\n};\n// Helper para obtener la sesión en el servidor\n\nconst getServerAuthSession = ()=>(0,next_auth__WEBPACK_IMPORTED_MODULE_4__.getServerSession)(authOptions);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2F1dGgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFDaUU7QUFDUjtBQUN2QjtBQUNHO0FBRTlCLE1BQU1JLGNBQStCO0lBQzFDQyxTQUFTSix3RUFBYUEsQ0FBQ0UsK0NBQU1BO0lBQzdCRyxTQUFTO1FBQ1BDLFVBQVU7SUFDWjtJQUNBQyxPQUFPO1FBQ0xDLFFBQVE7UUFDUkMsT0FBTztJQUNUO0lBQ0FDLFdBQVc7UUFDVFgsMkVBQW1CQSxDQUFDO1lBQ2xCWSxNQUFNO1lBQ05DLGFBQWE7Z0JBQ1hDLE9BQU87b0JBQUVDLE9BQU87b0JBQVVDLE1BQU07b0JBQVNDLGFBQWE7Z0JBQXFCO2dCQUMzRUMsVUFBVTtvQkFBRUgsT0FBTztvQkFBY0MsTUFBTTtnQkFBVztZQUNwRDtZQUNBLE1BQU1HLFdBQVVOLFdBQVc7Z0JBQ3pCLElBQUksQ0FBQ0EsYUFBYUMsU0FBUyxDQUFDRCxZQUFZSyxRQUFRLEVBQUU7b0JBQ2hELE9BQU87Z0JBQ1Q7Z0JBQ0EsMkJBQTJCO2dCQUMzQixNQUFNRSxPQUFPLE1BQU1qQiwrQ0FBTUEsQ0FBQ2lCLElBQUksQ0FBQ0MsVUFBVSxDQUFDO29CQUFFQyxPQUFPO3dCQUFFUixPQUFPRCxZQUFZQyxLQUFLO29CQUFDO2dCQUFFO2dCQUNoRixJQUFJLENBQUNNLE1BQU0sT0FBTztnQkFFbEIsTUFBTUcsVUFBVSxNQUFNckIsaURBQU9BLENBQUNXLFlBQVlLLFFBQVEsRUFBRUUsS0FBS0YsUUFBUTtnQkFDakUsSUFBSSxDQUFDSyxTQUFTLE9BQU87Z0JBRXJCLE9BQU87b0JBQ0xDLElBQUlKLEtBQUtJLEVBQUU7b0JBQ1hWLE9BQU9NLEtBQUtOLEtBQUs7b0JBQ2pCRixNQUFNUSxLQUFLUixJQUFJO29CQUNmYSxNQUFNTCxLQUFLSyxJQUFJO2dCQUNqQjtZQUNGO1FBQ0Y7S0FDRDtJQUNEQyxXQUFXO1FBQ1QsTUFBTUMsS0FBSSxFQUFFQyxLQUFLLEVBQUVSLElBQUksRUFBRTtZQUN2QixJQUFJQSxNQUFNO2dCQUNSUSxNQUFNSCxJQUFJLEdBQUcsS0FBY0EsSUFBSTtZQUNqQztZQUNBLE9BQU9HO1FBQ1Q7UUFDQSxNQUFNdEIsU0FBUSxFQUFFQSxPQUFPLEVBQUVzQixLQUFLLEVBQUU7WUFDOUIsSUFBSUEsU0FBU3RCLFFBQVFjLElBQUksRUFBRTtnQkFDekIscURBQXFEO2dCQUNwRGQsUUFBUWMsSUFBSSxDQUFTSyxJQUFJLEdBQUdHLE1BQU1ILElBQUk7Z0JBQ3ZDLElBQUlHLE1BQU1DLEdBQUcsRUFBRTtvQkFDWnZCLFFBQVFjLElBQUksQ0FBU0ksRUFBRSxHQUFHSSxNQUFNQyxHQUFHO2dCQUN0QztnQkFDQSxJQUFJRCxNQUFNZCxLQUFLLEVBQUU7b0JBQ2ZSLFFBQVFjLElBQUksQ0FBQ04sS0FBSyxHQUFHYyxNQUFNZCxLQUFLO2dCQUNsQztZQUNGO1lBQ0EsT0FBT1I7UUFDVDtRQUNBLE1BQU13QixVQUFTLEVBQUVDLEdBQUcsRUFBRUMsT0FBTyxFQUFFO1lBQzdCLDJDQUEyQztZQUMzQyxJQUFJRCxJQUFJRSxVQUFVLENBQUMsTUFBTSxPQUFPRjtZQUNoQyxJQUFJQSxJQUFJRyxRQUFRLENBQUMsV0FBVyxPQUFPSDtZQUNuQyxPQUFPQztRQUNUO0lBQ0Y7SUFDQUcsUUFBUUMsUUFBUUMsR0FBRyxDQUFDQyxlQUFlO0FBQ3JDLEVBQUM7QUFFRCwrQ0FBK0M7QUFDSDtBQUNyQyxNQUFNRSx1QkFBdUIsSUFBTUQsMkRBQWdCQSxDQUFDbkMsYUFBWSIsInNvdXJjZXMiOlsid2VicGFjazovL2dydXBvdmlzaW9uYXJpb3MvLi9zcmMvbGliL2F1dGgudHM/NjY5MiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0QXV0aE9wdGlvbnMgfSBmcm9tICduZXh0LWF1dGgnXG5pbXBvcnQgQ3JlZGVudGlhbHNQcm92aWRlciBmcm9tICduZXh0LWF1dGgvcHJvdmlkZXJzL2NyZWRlbnRpYWxzJ1xuaW1wb3J0IHsgUHJpc21hQWRhcHRlciB9IGZyb20gJ0BuZXh0LWF1dGgvcHJpc21hLWFkYXB0ZXInXG5pbXBvcnQgeyBjb21wYXJlIH0gZnJvbSAnYmNyeXB0anMnXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICdAL2xpYi9wcmlzbWEnXG5cbmV4cG9ydCBjb25zdCBhdXRoT3B0aW9uczogTmV4dEF1dGhPcHRpb25zID0ge1xuICBhZGFwdGVyOiBQcmlzbWFBZGFwdGVyKHByaXNtYSkgYXMgYW55LFxuICBzZXNzaW9uOiB7XG4gICAgc3RyYXRlZ3k6ICdqd3QnLFxuICB9LFxuICBwYWdlczoge1xuICAgIHNpZ25JbjogJy9hdXRoL2xvZ2luJyxcbiAgICBlcnJvcjogJy9hdXRoL2xvZ2luJyxcbiAgfSxcbiAgcHJvdmlkZXJzOiBbXG4gICAgQ3JlZGVudGlhbHNQcm92aWRlcih7XG4gICAgICBuYW1lOiAnQ3JlZGVudGlhbHMnLFxuICAgICAgY3JlZGVudGlhbHM6IHtcbiAgICAgICAgZW1haWw6IHsgbGFiZWw6ICdDb3JyZW8nLCB0eXBlOiAnZW1haWwnLCBwbGFjZWhvbGRlcjogJ2NvcnJlb0BleGFtcGxlLmNvbScgfSxcbiAgICAgICAgcGFzc3dvcmQ6IHsgbGFiZWw6ICdDb250cmFzZcOxYScsIHR5cGU6ICdwYXNzd29yZCcgfSxcbiAgICAgIH0sXG4gICAgICBhc3luYyBhdXRob3JpemUoY3JlZGVudGlhbHMpIHtcbiAgICAgICAgaWYgKCFjcmVkZW50aWFscz8uZW1haWwgfHwgIWNyZWRlbnRpYWxzLnBhc3N3b3JkKSB7XG4gICAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgICAgfVxuICAgICAgICAvLyBCdXNjYXIgdXN1YXJpbyBwb3IgZW1haWxcbiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoeyB3aGVyZTogeyBlbWFpbDogY3JlZGVudGlhbHMuZW1haWwgfSB9KVxuICAgICAgICBpZiAoIXVzZXIpIHJldHVybiBudWxsXG5cbiAgICAgICAgY29uc3QgaXNWYWxpZCA9IGF3YWl0IGNvbXBhcmUoY3JlZGVudGlhbHMucGFzc3dvcmQsIHVzZXIucGFzc3dvcmQpXG4gICAgICAgIGlmICghaXNWYWxpZCkgcmV0dXJuIG51bGxcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGlkOiB1c2VyLmlkLFxuICAgICAgICAgIGVtYWlsOiB1c2VyLmVtYWlsLFxuICAgICAgICAgIG5hbWU6IHVzZXIubmFtZSxcbiAgICAgICAgICByb2xlOiB1c2VyLnJvbGUsXG4gICAgICAgIH0gYXMgYW55XG4gICAgICB9LFxuICAgIH0pLFxuICBdLFxuICBjYWxsYmFja3M6IHtcbiAgICBhc3luYyBqd3QoeyB0b2tlbiwgdXNlciB9KSB7XG4gICAgICBpZiAodXNlcikge1xuICAgICAgICB0b2tlbi5yb2xlID0gKHVzZXIgYXMgYW55KS5yb2xlXG4gICAgICB9XG4gICAgICByZXR1cm4gdG9rZW5cbiAgICB9LFxuICAgIGFzeW5jIHNlc3Npb24oeyBzZXNzaW9uLCB0b2tlbiB9KSB7XG4gICAgICBpZiAodG9rZW4gJiYgc2Vzc2lvbi51c2VyKSB7XG4gICAgICAgIC8vIENvcGlhciBpbmZvcm1hY2nDs24gcmVsZXZhbnRlIGRlbCB0b2tlbiBhIGxhIHNlc2nDs25cbiAgICAgICAgKHNlc3Npb24udXNlciBhcyBhbnkpLnJvbGUgPSB0b2tlbi5yb2xlXG4gICAgICAgIGlmICh0b2tlbi5zdWIpIHtcbiAgICAgICAgICAoc2Vzc2lvbi51c2VyIGFzIGFueSkuaWQgPSB0b2tlbi5zdWJcbiAgICAgICAgfVxuICAgICAgICBpZiAodG9rZW4uZW1haWwpIHtcbiAgICAgICAgICBzZXNzaW9uLnVzZXIuZW1haWwgPSB0b2tlbi5lbWFpbCBhcyBzdHJpbmdcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHNlc3Npb25cbiAgICB9LFxuICAgIGFzeW5jIHJlZGlyZWN0KHsgdXJsLCBiYXNlVXJsIH0pIHtcbiAgICAgIC8vIEFmdGVyIHNpZ24taW4gcmVkaXJlY3QgYWNjb3JkaW5nIHRvIHJvbGVcbiAgICAgIGlmICh1cmwuc3RhcnRzV2l0aCgnLycpKSByZXR1cm4gdXJsXG4gICAgICBpZiAodXJsLmluY2x1ZGVzKCcvYWRtaW4nKSkgcmV0dXJuIHVybFxuICAgICAgcmV0dXJuIGJhc2VVcmxcbiAgICB9LFxuICB9LFxuICBzZWNyZXQ6IHByb2Nlc3MuZW52Lk5FWFRBVVRIX1NFQ1JFVCxcbn1cblxuLy8gSGVscGVyIHBhcmEgb2J0ZW5lciBsYSBzZXNpw7NuIGVuIGVsIHNlcnZpZG9yXG5pbXBvcnQgeyBnZXRTZXJ2ZXJTZXNzaW9uIH0gZnJvbSAnbmV4dC1hdXRoJ1xuZXhwb3J0IGNvbnN0IGdldFNlcnZlckF1dGhTZXNzaW9uID0gKCkgPT4gZ2V0U2VydmVyU2Vzc2lvbihhdXRoT3B0aW9ucykgIl0sIm5hbWVzIjpbIkNyZWRlbnRpYWxzUHJvdmlkZXIiLCJQcmlzbWFBZGFwdGVyIiwiY29tcGFyZSIsInByaXNtYSIsImF1dGhPcHRpb25zIiwiYWRhcHRlciIsInNlc3Npb24iLCJzdHJhdGVneSIsInBhZ2VzIiwic2lnbkluIiwiZXJyb3IiLCJwcm92aWRlcnMiLCJuYW1lIiwiY3JlZGVudGlhbHMiLCJlbWFpbCIsImxhYmVsIiwidHlwZSIsInBsYWNlaG9sZGVyIiwicGFzc3dvcmQiLCJhdXRob3JpemUiLCJ1c2VyIiwiZmluZFVuaXF1ZSIsIndoZXJlIiwiaXNWYWxpZCIsImlkIiwicm9sZSIsImNhbGxiYWNrcyIsImp3dCIsInRva2VuIiwic3ViIiwicmVkaXJlY3QiLCJ1cmwiLCJiYXNlVXJsIiwic3RhcnRzV2l0aCIsImluY2x1ZGVzIiwic2VjcmV0IiwicHJvY2VzcyIsImVudiIsIk5FWFRBVVRIX1NFQ1JFVCIsImdldFNlcnZlclNlc3Npb24iLCJnZXRTZXJ2ZXJBdXRoU2Vzc2lvbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/auth.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/multilevel-system.ts":
/*!**************************************!*\
  !*** ./src/lib/multilevel-system.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   evaluateUserPromotion: () => (/* binding */ evaluateUserPromotion),\n/* harmony export */   getDirectReferrals: () => (/* binding */ getDirectReferrals),\n/* harmony export */   getUserLevelInfo: () => (/* binding */ getUserLevelInfo),\n/* harmony export */   getUserReferralStructure: () => (/* binding */ getUserReferralStructure),\n/* harmony export */   hasThreeReferralsEach: () => (/* binding */ hasThreeReferralsEach),\n/* harmony export */   promoteUser: () => (/* binding */ promoteUser),\n/* harmony export */   registerReferralAndEvaluate: () => (/* binding */ registerReferralAndEvaluate)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nconst prisma = new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient();\n/**\r\n * Get direct referrals for a user\r\n */ async function getDirectReferrals(userId) {\n    try {\n        const referrals = await prisma.user.findMany({\n            where: {\n                referredBy: userId,\n                isActive: true\n            },\n            include: {\n                level: true,\n                referrals: {\n                    where: {\n                        isActive: true\n                    },\n                    select: {\n                        id: true\n                    }\n                }\n            },\n            orderBy: {\n                createdAt: \"desc\"\n            }\n        });\n        return referrals.map((user)=>({\n                ...user,\n                referralCount: user.referrals.length\n            }));\n    } catch (error) {\n        console.error(\"Error fetching direct referrals:\", error);\n        return [];\n    }\n}\n/**\r\n * Check if each of the 3 direct referrals has at least 3 referrals\r\n */ async function hasThreeReferralsEach(referrals) {\n    if (referrals.length < 3) return false;\n    // Check the first 3 referrals (most important ones)\n    const firstThreeReferrals = referrals.slice(0, 3);\n    for (const referral of firstThreeReferrals){\n        const referralCount = await prisma.user.count({\n            where: {\n                referredBy: referral.id,\n                isActive: true\n            }\n        });\n        if (referralCount < 3) {\n            return false;\n        }\n    }\n    return true;\n}\n/**\r\n * Get the complete referral structure for a user (tree format)\r\n */ async function getUserReferralStructure(userId, maxDepth = 3) {\n    try {\n        const user = await prisma.user.findUnique({\n            where: {\n                id: userId\n            },\n            include: {\n                level: true\n            }\n        });\n        if (!user) return null;\n        if (!user.level) {\n            throw new Error(\"El usuario no tiene nivel asignado\");\n        }\n        const directReferrals = await getDirectReferralsRecursive(userId, maxDepth);\n        return {\n            id: user.id,\n            name: user.name,\n            email: user.email,\n            level: {\n                id: user.level.id,\n                name: user.level.name,\n                order: user.level.order,\n                color: user.level.color,\n                icon: user.level.icon ?? null\n            },\n            directReferrals,\n            referralCount: directReferrals.length,\n            isActive: user.isActive,\n            joinDate: user.createdAt\n        };\n    } catch (error) {\n        console.error(\"Error fetching user referral structure:\", error);\n        return null;\n    }\n}\n/**\r\n * Helper function to get referrals recursively\r\n */ async function getDirectReferralsRecursive(userId, depth) {\n    if (depth <= 0) return [];\n    const referrals = await prisma.user.findMany({\n        where: {\n            referredBy: userId,\n            isActive: true\n        },\n        include: {\n            level: true\n        },\n        orderBy: {\n            createdAt: \"desc\"\n        }\n    });\n    const result = [];\n    for (const referral of referrals){\n        const childReferrals = await getDirectReferralsRecursive(referral.id, depth - 1);\n        result.push({\n            id: referral.id,\n            name: referral.name,\n            email: referral.email,\n            level: {\n                id: referral.level.id,\n                name: referral.level.name,\n                order: referral.level.order,\n                color: referral.level.color,\n                icon: referral.level.icon ?? null\n            },\n            directReferrals: childReferrals,\n            referralCount: childReferrals.length,\n            isActive: referral.isActive,\n            joinDate: referral.createdAt\n        });\n    }\n    return result;\n}\n/**\r\n * Evaluate if a user can be promoted to the next level\r\n */ async function evaluateUserPromotion(userId) {\n    try {\n        const user = await prisma.user.findUnique({\n            where: {\n                id: userId\n            },\n            include: {\n                level: true\n            }\n        });\n        if (!user) {\n            throw new Error(\"User not found\");\n        }\n        if (!user.level) {\n            throw new Error(\"User does not have an assigned level\");\n        }\n        const directReferrals = await getDirectReferrals(userId);\n        const directReferralsCount = directReferrals.length;\n        // Check if user has at least 3 direct referrals\n        if (directReferralsCount < 3) {\n            return {\n                canPromote: false,\n                currentLevel: user.level.order,\n                directReferrals: directReferralsCount,\n                validSecondLevelReferrals: 0,\n                requiredStructure: \"3 referidos directos + 9 referidos indirectos (3x3)\",\n                missingRequirements: [\n                    `Necesitas ${3 - directReferralsCount} referidos directos más`\n                ]\n            };\n        }\n        // Check if the first 3 referrals each have at least 3 referrals (3x3 structure)\n        const hasValidStructure = await hasThreeReferralsEach(directReferrals);\n        if (!hasValidStructure) {\n            // Count how many of the first 3 have valid structures\n            const firstThree = directReferrals.slice(0, 3);\n            let validCount = 0;\n            const missingRequirements = [];\n            for(let i = 0; i < firstThree.length; i++){\n                const referralCount = await prisma.user.count({\n                    where: {\n                        referredBy: firstThree[i].id,\n                        isActive: true\n                    }\n                });\n                if (referralCount >= 3) {\n                    validCount++;\n                } else {\n                    missingRequirements.push(`${firstThree[i].name} necesita ${3 - referralCount} referidos más`);\n                }\n            }\n            return {\n                canPromote: false,\n                currentLevel: user.level.order,\n                directReferrals: directReferralsCount,\n                validSecondLevelReferrals: validCount,\n                requiredStructure: \"3 referidos directos + 9 referidos indirectos (3x3)\",\n                missingRequirements\n            };\n        }\n        // Get next level\n        const nextLevel = await prisma.level.findFirst({\n            where: {\n                order: user.level.order + 1\n            }\n        });\n        return {\n            canPromote: true,\n            currentLevel: user.level.order,\n            nextLevel: nextLevel?.order,\n            directReferrals: directReferralsCount,\n            validSecondLevelReferrals: 3,\n            requiredStructure: \"3 referidos directos + 9 referidos indirectos (3x3)\"\n        };\n    } catch (error) {\n        console.error(\"Error evaluating user promotion:\", error);\n        throw error;\n    }\n}\n/**\r\n * Promote user to the next level\r\n */ async function promoteUser(userId) {\n    try {\n        const evaluation = await evaluateUserPromotion(userId);\n        if (!evaluation.canPromote) {\n            return {\n                success: false,\n                error: `No cumple los requisitos: ${evaluation.missingRequirements?.join(\", \")}`\n            };\n        }\n        const user = await prisma.user.findUnique({\n            where: {\n                id: userId\n            },\n            include: {\n                level: true\n            }\n        });\n        if (!user) {\n            return {\n                success: false,\n                error: \"Usuario no encontrado\"\n            };\n        }\n        if (!user.level) {\n            return {\n                success: false,\n                error: \"El usuario no tiene nivel asignado\"\n            };\n        }\n        const nextLevel = await prisma.level.findFirst({\n            where: {\n                order: user.level.order + 1\n            }\n        });\n        if (!nextLevel) {\n            return {\n                success: false,\n                error: \"No hay siguiente nivel disponible\"\n            };\n        }\n        // Start transaction\n        const result = await prisma.$transaction(async (tx)=>{\n            // Update user level\n            const updatedUser = await tx.user.update({\n                where: {\n                    id: userId\n                },\n                data: {\n                    levelId: nextLevel.id\n                },\n                include: {\n                    level: true\n                }\n            });\n            // Create promotion record\n            await tx.promotion.create({\n                data: {\n                    userId,\n                    fromLevelId: user.level.id,\n                    toLevelId: nextLevel.id,\n                    reason: \"Promoci\\xf3n autom\\xe1tica\",\n                    metadata: {\n                        directReferrals: evaluation.directReferrals,\n                        validStructure: true\n                    }\n                }\n            });\n            return updatedUser;\n        });\n        return {\n            success: true,\n            newLevel: result.level\n        };\n    } catch (error) {\n        console.error(\"Error promoting user:\", error);\n        return {\n            success: false,\n            error: \"Error interno del servidor\"\n        };\n    }\n}\n/**\r\n * Register a new referral and check for automatic promotion\r\n */ async function registerReferralAndEvaluate(referrerId, referredUserId) {\n    try {\n        // Create referral record\n        const referral = await prisma.referral.create({\n            data: {\n                referrerId,\n                referredId: referredUserId,\n                level: 1,\n                commission: 0,\n                status: \"APPROVED\"\n            }\n        });\n        // Evaluate if referrer can be promoted\n        const evaluation = await evaluateUserPromotion(referrerId);\n        let promotionResult = null;\n        if (evaluation.canPromote) {\n            promotionResult = await promoteUser(referrerId);\n        }\n        return {\n            success: true,\n            referralCreated: true,\n            promotionEvaluated: true,\n            promoted: promotionResult?.success || false,\n            newLevel: promotionResult?.newLevel\n        };\n    } catch (error) {\n        console.error(\"Error registering referral and evaluating promotion:\", error);\n        return {\n            success: false,\n            referralCreated: false,\n            promotionEvaluated: false,\n            error: \"Error interno del servidor\"\n        };\n    }\n}\n/**\r\n * Get user's current level info with progress\r\n */ async function getUserLevelInfo(userId) {\n    try {\n        const user = await prisma.user.findUnique({\n            where: {\n                id: userId\n            },\n            include: {\n                level: true,\n                promotionHistory: {\n                    orderBy: {\n                        createdAt: \"desc\"\n                    },\n                    take: 5\n                }\n            }\n        });\n        if (!user) return null;\n        if (!user.level) {\n            throw new Error(\"El usuario no tiene nivel asignado\");\n        }\n        const evaluation = await evaluateUserPromotion(userId);\n        const nextLevel = await prisma.level.findFirst({\n            where: {\n                order: user.level.order + 1\n            }\n        });\n        return {\n            currentLevel: user.level,\n            nextLevel,\n            evaluation,\n            promotionHistory: user.promotionHistory,\n            canPromote: evaluation.canPromote\n        };\n    } catch (error) {\n        console.error(\"Error getting user level info:\", error);\n        return null;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUc7WUFDN0I7UUFDRjtRQUVBLE9BQU87WUFDTFcsY0FBY3hDLEtBQUtNLEtBQUs7WUFDeEIwQztZQUNBRztZQUNBNEIsa0JBQWtCL0UsS0FBSytFLGdCQUFnQjtZQUN2Q3hDLFlBQVlZLFdBQVdaLFVBQVU7UUFDbkM7SUFFRixFQUFFLE9BQU96QixPQUFPO1FBQ2RDLFFBQVFELEtBQUssQ0FBQyxrQ0FBa0NBO1FBQ2hELE9BQU87SUFDVDtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZ3J1cG92aXNpb25hcmlvcy8uL3NyYy9saWIvbXVsdGlsZXZlbC1zeXN0ZW0udHM/ZDU0YSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tICdAcHJpc21hL2NsaWVudCdcclxuXHJcbmNvbnN0IHByaXNtYSA9IG5ldyBQcmlzbWFDbGllbnQoKVxyXG5cclxuLy8gVHlwZXMgZm9yIHRoZSBtdWx0aWxldmVsIHN5c3RlbVxyXG5leHBvcnQgaW50ZXJmYWNlIFVzZXJSZWZlcnJhbFN0cnVjdHVyZSB7XHJcbiAgaWQ6IHN0cmluZ1xyXG4gIG5hbWU6IHN0cmluZ1xyXG4gIGVtYWlsOiBzdHJpbmdcclxuICBsZXZlbDoge1xyXG4gICAgaWQ6IHN0cmluZ1xyXG4gICAgbmFtZTogc3RyaW5nXHJcbiAgICBvcmRlcjogbnVtYmVyXHJcbiAgICBjb2xvcjogc3RyaW5nXHJcbiAgICBpY29uOiBzdHJpbmcgfCBudWxsIC8vIGljb25vIHB1ZWRlIHNlciBudWxvIGVuIGxhIHRhYmxhIExldmVsXHJcbiAgfVxyXG4gIGRpcmVjdFJlZmVycmFsczogVXNlclJlZmVycmFsU3RydWN0dXJlW11cclxuICByZWZlcnJhbENvdW50OiBudW1iZXJcclxuICBpc0FjdGl2ZTogYm9vbGVhblxyXG4gIGpvaW5EYXRlOiBEYXRlXHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgUHJvbW90aW9uRXZhbHVhdGlvbiB7XHJcbiAgY2FuUHJvbW90ZTogYm9vbGVhblxyXG4gIGN1cnJlbnRMZXZlbDogbnVtYmVyXHJcbiAgbmV4dExldmVsPzogbnVtYmVyXHJcbiAgZGlyZWN0UmVmZXJyYWxzOiBudW1iZXJcclxuICB2YWxpZFNlY29uZExldmVsUmVmZXJyYWxzOiBudW1iZXJcclxuICByZXF1aXJlZFN0cnVjdHVyZTogc3RyaW5nXHJcbiAgbWlzc2luZ1JlcXVpcmVtZW50cz86IHN0cmluZ1tdXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBHZXQgZGlyZWN0IHJlZmVycmFscyBmb3IgYSB1c2VyXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0RGlyZWN0UmVmZXJyYWxzKHVzZXJJZDogc3RyaW5nKSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHJlZmVycmFscyA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRNYW55KHtcclxuICAgICAgd2hlcmU6IHsgXHJcbiAgICAgICAgcmVmZXJyZWRCeTogdXNlcklkLFxyXG4gICAgICAgIGlzQWN0aXZlOiB0cnVlIFxyXG4gICAgICB9LFxyXG4gICAgICBpbmNsdWRlOiB7XHJcbiAgICAgICAgbGV2ZWw6IHRydWUsXHJcbiAgICAgICAgcmVmZXJyYWxzOiB7XHJcbiAgICAgICAgICB3aGVyZTogeyBpc0FjdGl2ZTogdHJ1ZSB9LFxyXG4gICAgICAgICAgc2VsZWN0OiB7IGlkOiB0cnVlIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0sXHJcbiAgICAgIG9yZGVyQnk6IHsgY3JlYXRlZEF0OiAnZGVzYycgfVxyXG4gICAgfSlcclxuXHJcbiAgICByZXR1cm4gcmVmZXJyYWxzLm1hcCh1c2VyID0+ICh7XHJcbiAgICAgIC4uLnVzZXIsXHJcbiAgICAgIHJlZmVycmFsQ291bnQ6IHVzZXIucmVmZXJyYWxzLmxlbmd0aFxyXG4gICAgfSkpXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIGRpcmVjdCByZWZlcnJhbHM6JywgZXJyb3IpXHJcbiAgICByZXR1cm4gW11cclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDaGVjayBpZiBlYWNoIG9mIHRoZSAzIGRpcmVjdCByZWZlcnJhbHMgaGFzIGF0IGxlYXN0IDMgcmVmZXJyYWxzXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFzVGhyZWVSZWZlcnJhbHNFYWNoKHJlZmVycmFsczogYW55W10pOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICBpZiAocmVmZXJyYWxzLmxlbmd0aCA8IDMpIHJldHVybiBmYWxzZVxyXG5cclxuICAvLyBDaGVjayB0aGUgZmlyc3QgMyByZWZlcnJhbHMgKG1vc3QgaW1wb3J0YW50IG9uZXMpXHJcbiAgY29uc3QgZmlyc3RUaHJlZVJlZmVycmFscyA9IHJlZmVycmFscy5zbGljZSgwLCAzKVxyXG4gIFxyXG4gIGZvciAoY29uc3QgcmVmZXJyYWwgb2YgZmlyc3RUaHJlZVJlZmVycmFscykge1xyXG4gICAgY29uc3QgcmVmZXJyYWxDb3VudCA9IGF3YWl0IHByaXNtYS51c2VyLmNvdW50KHtcclxuICAgICAgd2hlcmU6IHsgXHJcbiAgICAgICAgcmVmZXJyZWRCeTogcmVmZXJyYWwuaWQsXHJcbiAgICAgICAgaXNBY3RpdmU6IHRydWUgXHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgICBcclxuICAgIGlmIChyZWZlcnJhbENvdW50IDwgMykge1xyXG4gICAgICByZXR1cm4gZmFsc2VcclxuICAgIH1cclxuICB9XHJcbiAgXHJcbiAgcmV0dXJuIHRydWVcclxufVxyXG5cclxuLyoqXHJcbiAqIEdldCB0aGUgY29tcGxldGUgcmVmZXJyYWwgc3RydWN0dXJlIGZvciBhIHVzZXIgKHRyZWUgZm9ybWF0KVxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFVzZXJSZWZlcnJhbFN0cnVjdHVyZSh1c2VySWQ6IHN0cmluZywgbWF4RGVwdGg6IG51bWJlciA9IDMpOiBQcm9taXNlPFVzZXJSZWZlcnJhbFN0cnVjdHVyZSB8IG51bGw+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xyXG4gICAgICB3aGVyZTogeyBpZDogdXNlcklkIH0sXHJcbiAgICAgIGluY2x1ZGU6IHtcclxuICAgICAgICBsZXZlbDogdHJ1ZVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG5cclxuICAgIGlmICghdXNlcikgcmV0dXJuIG51bGxcclxuICAgIGlmICghdXNlci5sZXZlbCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0VsIHVzdWFyaW8gbm8gdGllbmUgbml2ZWwgYXNpZ25hZG8nKVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGRpcmVjdFJlZmVycmFscyA9IGF3YWl0IGdldERpcmVjdFJlZmVycmFsc1JlY3Vyc2l2ZSh1c2VySWQsIG1heERlcHRoKVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIGlkOiB1c2VyLmlkLFxyXG4gICAgICBuYW1lOiB1c2VyLm5hbWUsXHJcbiAgICAgIGVtYWlsOiB1c2VyLmVtYWlsLFxyXG4gICAgICBsZXZlbDoge1xyXG4gICAgICAgIGlkOiB1c2VyLmxldmVsIS5pZCxcclxuICAgICAgICBuYW1lOiB1c2VyLmxldmVsIS5uYW1lLFxyXG4gICAgICAgIG9yZGVyOiB1c2VyLmxldmVsIS5vcmRlcixcclxuICAgICAgICBjb2xvcjogdXNlci5sZXZlbCEuY29sb3IsXHJcbiAgICAgICAgaWNvbjogdXNlci5sZXZlbCEuaWNvbiA/PyBudWxsXHJcbiAgICAgIH0sXHJcbiAgICAgIGRpcmVjdFJlZmVycmFscyxcclxuICAgICAgcmVmZXJyYWxDb3VudDogZGlyZWN0UmVmZXJyYWxzLmxlbmd0aCxcclxuICAgICAgaXNBY3RpdmU6IHVzZXIuaXNBY3RpdmUsXHJcbiAgICAgIGpvaW5EYXRlOiB1c2VyLmNyZWF0ZWRBdFxyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyB1c2VyIHJlZmVycmFsIHN0cnVjdHVyZTonLCBlcnJvcilcclxuICAgIHJldHVybiBudWxsXHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogSGVscGVyIGZ1bmN0aW9uIHRvIGdldCByZWZlcnJhbHMgcmVjdXJzaXZlbHlcclxuICovXHJcbmFzeW5jIGZ1bmN0aW9uIGdldERpcmVjdFJlZmVycmFsc1JlY3Vyc2l2ZSh1c2VySWQ6IHN0cmluZywgZGVwdGg6IG51bWJlcik6IFByb21pc2U8VXNlclJlZmVycmFsU3RydWN0dXJlW10+IHtcclxuICBpZiAoZGVwdGggPD0gMCkgcmV0dXJuIFtdXHJcblxyXG4gIGNvbnN0IHJlZmVycmFscyA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRNYW55KHtcclxuICAgIHdoZXJlOiB7IFxyXG4gICAgICByZWZlcnJlZEJ5OiB1c2VySWQsXHJcbiAgICAgIGlzQWN0aXZlOiB0cnVlIFxyXG4gICAgfSxcclxuICAgIGluY2x1ZGU6IHtcclxuICAgICAgbGV2ZWw6IHRydWVcclxuICAgIH0sXHJcbiAgICBvcmRlckJ5OiB7IGNyZWF0ZWRBdDogJ2Rlc2MnIH1cclxuICB9KVxyXG5cclxuICBjb25zdCByZXN1bHQ6IFVzZXJSZWZlcnJhbFN0cnVjdHVyZVtdID0gW11cclxuICBcclxuICBmb3IgKGNvbnN0IHJlZmVycmFsIG9mIHJlZmVycmFscykge1xyXG4gICAgY29uc3QgY2hpbGRSZWZlcnJhbHMgPSBhd2FpdCBnZXREaXJlY3RSZWZlcnJhbHNSZWN1cnNpdmUocmVmZXJyYWwuaWQsIGRlcHRoIC0gMSlcclxuICAgIFxyXG4gICAgcmVzdWx0LnB1c2goe1xyXG4gICAgICBpZDogcmVmZXJyYWwuaWQsXHJcbiAgICAgIG5hbWU6IHJlZmVycmFsLm5hbWUsXHJcbiAgICAgIGVtYWlsOiByZWZlcnJhbC5lbWFpbCxcclxuICAgICAgbGV2ZWw6IHtcclxuICAgICAgICBpZDogcmVmZXJyYWwubGV2ZWwhLmlkLFxyXG4gICAgICAgIG5hbWU6IHJlZmVycmFsLmxldmVsIS5uYW1lLFxyXG4gICAgICAgIG9yZGVyOiByZWZlcnJhbC5sZXZlbCEub3JkZXIsXHJcbiAgICAgICAgY29sb3I6IHJlZmVycmFsLmxldmVsIS5jb2xvcixcclxuICAgICAgICBpY29uOiByZWZlcnJhbC5sZXZlbCEuaWNvbiA/PyBudWxsXHJcbiAgICAgIH0sXHJcbiAgICAgIGRpcmVjdFJlZmVycmFsczogY2hpbGRSZWZlcnJhbHMsXHJcbiAgICAgIHJlZmVycmFsQ291bnQ6IGNoaWxkUmVmZXJyYWxzLmxlbmd0aCxcclxuICAgICAgaXNBY3RpdmU6IHJlZmVycmFsLmlzQWN0aXZlLFxyXG4gICAgICBqb2luRGF0ZTogcmVmZXJyYWwuY3JlYXRlZEF0XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcbiAgcmV0dXJuIHJlc3VsdFxyXG59XHJcblxyXG4vKipcclxuICogRXZhbHVhdGUgaWYgYSB1c2VyIGNhbiBiZSBwcm9tb3RlZCB0byB0aGUgbmV4dCBsZXZlbFxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGV2YWx1YXRlVXNlclByb21vdGlvbih1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8UHJvbW90aW9uRXZhbHVhdGlvbj4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XHJcbiAgICAgIHdoZXJlOiB7IGlkOiB1c2VySWQgfSxcclxuICAgICAgaW5jbHVkZTogeyBsZXZlbDogdHJ1ZSB9XHJcbiAgICB9KVxyXG5cclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VzZXIgbm90IGZvdW5kJylcclxuICAgIH1cclxuICAgIGlmICghdXNlci5sZXZlbCkge1xyXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VzZXIgZG9lcyBub3QgaGF2ZSBhbiBhc3NpZ25lZCBsZXZlbCcpXHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZGlyZWN0UmVmZXJyYWxzID0gYXdhaXQgZ2V0RGlyZWN0UmVmZXJyYWxzKHVzZXJJZClcclxuICAgIGNvbnN0IGRpcmVjdFJlZmVycmFsc0NvdW50ID0gZGlyZWN0UmVmZXJyYWxzLmxlbmd0aFxyXG4gICAgXHJcbiAgICAvLyBDaGVjayBpZiB1c2VyIGhhcyBhdCBsZWFzdCAzIGRpcmVjdCByZWZlcnJhbHNcclxuICAgIGlmIChkaXJlY3RSZWZlcnJhbHNDb3VudCA8IDMpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBjYW5Qcm9tb3RlOiBmYWxzZSxcclxuICAgICAgICBjdXJyZW50TGV2ZWw6IHVzZXIubGV2ZWwhLm9yZGVyLFxyXG4gICAgICAgIGRpcmVjdFJlZmVycmFsczogZGlyZWN0UmVmZXJyYWxzQ291bnQsXHJcbiAgICAgICAgdmFsaWRTZWNvbmRMZXZlbFJlZmVycmFsczogMCxcclxuICAgICAgICByZXF1aXJlZFN0cnVjdHVyZTogJzMgcmVmZXJpZG9zIGRpcmVjdG9zICsgOSByZWZlcmlkb3MgaW5kaXJlY3RvcyAoM3gzKScsXHJcbiAgICAgICAgbWlzc2luZ1JlcXVpcmVtZW50czogW2BOZWNlc2l0YXMgJHszIC0gZGlyZWN0UmVmZXJyYWxzQ291bnR9IHJlZmVyaWRvcyBkaXJlY3RvcyBtw6FzYF1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIENoZWNrIGlmIHRoZSBmaXJzdCAzIHJlZmVycmFscyBlYWNoIGhhdmUgYXQgbGVhc3QgMyByZWZlcnJhbHMgKDN4MyBzdHJ1Y3R1cmUpXHJcbiAgICBjb25zdCBoYXNWYWxpZFN0cnVjdHVyZSA9IGF3YWl0IGhhc1RocmVlUmVmZXJyYWxzRWFjaChkaXJlY3RSZWZlcnJhbHMpXHJcbiAgICBcclxuICAgIGlmICghaGFzVmFsaWRTdHJ1Y3R1cmUpIHtcclxuICAgICAgLy8gQ291bnQgaG93IG1hbnkgb2YgdGhlIGZpcnN0IDMgaGF2ZSB2YWxpZCBzdHJ1Y3R1cmVzXHJcbiAgICAgIGNvbnN0IGZpcnN0VGhyZWUgPSBkaXJlY3RSZWZlcnJhbHMuc2xpY2UoMCwgMylcclxuICAgICAgbGV0IHZhbGlkQ291bnQgPSAwXHJcbiAgICAgIGNvbnN0IG1pc3NpbmdSZXF1aXJlbWVudHM6IHN0cmluZ1tdID0gW11cclxuXHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlyc3RUaHJlZS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGNvbnN0IHJlZmVycmFsQ291bnQgPSBhd2FpdCBwcmlzbWEudXNlci5jb3VudCh7XHJcbiAgICAgICAgICB3aGVyZTogeyBcclxuICAgICAgICAgICAgcmVmZXJyZWRCeTogZmlyc3RUaHJlZVtpXS5pZCxcclxuICAgICAgICAgICAgaXNBY3RpdmU6IHRydWUgXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgICBcclxuICAgICAgICBpZiAocmVmZXJyYWxDb3VudCA+PSAzKSB7XHJcbiAgICAgICAgICB2YWxpZENvdW50KytcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgbWlzc2luZ1JlcXVpcmVtZW50cy5wdXNoKFxyXG4gICAgICAgICAgICBgJHtmaXJzdFRocmVlW2ldLm5hbWV9IG5lY2VzaXRhICR7MyAtIHJlZmVycmFsQ291bnR9IHJlZmVyaWRvcyBtw6FzYFxyXG4gICAgICAgICAgKVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBjYW5Qcm9tb3RlOiBmYWxzZSxcclxuICAgICAgICBjdXJyZW50TGV2ZWw6IHVzZXIubGV2ZWwhLm9yZGVyLFxyXG4gICAgICAgIGRpcmVjdFJlZmVycmFsczogZGlyZWN0UmVmZXJyYWxzQ291bnQsXHJcbiAgICAgICAgdmFsaWRTZWNvbmRMZXZlbFJlZmVycmFsczogdmFsaWRDb3VudCxcclxuICAgICAgICByZXF1aXJlZFN0cnVjdHVyZTogJzMgcmVmZXJpZG9zIGRpcmVjdG9zICsgOSByZWZlcmlkb3MgaW5kaXJlY3RvcyAoM3gzKScsXHJcbiAgICAgICAgbWlzc2luZ1JlcXVpcmVtZW50c1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gR2V0IG5leHQgbGV2ZWxcclxuICAgIGNvbnN0IG5leHRMZXZlbCA9IGF3YWl0IHByaXNtYS5sZXZlbC5maW5kRmlyc3Qoe1xyXG4gICAgICB3aGVyZTogeyBcclxuICAgICAgICBvcmRlcjogdXNlci5sZXZlbCEub3JkZXIgKyAxXHJcbiAgICAgIH1cclxuICAgIH0pXHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgY2FuUHJvbW90ZTogdHJ1ZSxcclxuICAgICAgY3VycmVudExldmVsOiB1c2VyLmxldmVsIS5vcmRlcixcclxuICAgICAgbmV4dExldmVsOiBuZXh0TGV2ZWw/Lm9yZGVyLFxyXG4gICAgICBkaXJlY3RSZWZlcnJhbHM6IGRpcmVjdFJlZmVycmFsc0NvdW50LFxyXG4gICAgICB2YWxpZFNlY29uZExldmVsUmVmZXJyYWxzOiAzLFxyXG4gICAgICByZXF1aXJlZFN0cnVjdHVyZTogJzMgcmVmZXJpZG9zIGRpcmVjdG9zICsgOSByZWZlcmlkb3MgaW5kaXJlY3RvcyAoM3gzKSdcclxuICAgIH1cclxuXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGV2YWx1YXRpbmcgdXNlciBwcm9tb3Rpb246JywgZXJyb3IpXHJcbiAgICB0aHJvdyBlcnJvclxyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIFByb21vdGUgdXNlciB0byB0aGUgbmV4dCBsZXZlbFxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByb21vdGVVc2VyKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG5ld0xldmVsPzogYW55OyBlcnJvcj86IHN0cmluZyB9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGV2YWx1YXRpb24gPSBhd2FpdCBldmFsdWF0ZVVzZXJQcm9tb3Rpb24odXNlcklkKVxyXG4gICAgXHJcbiAgICBpZiAoIWV2YWx1YXRpb24uY2FuUHJvbW90ZSkge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIGVycm9yOiBgTm8gY3VtcGxlIGxvcyByZXF1aXNpdG9zOiAke2V2YWx1YXRpb24ubWlzc2luZ1JlcXVpcmVtZW50cz8uam9pbignLCAnKX1gXHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZFVuaXF1ZSh7XHJcbiAgICAgIHdoZXJlOiB7IGlkOiB1c2VySWQgfSxcclxuICAgICAgaW5jbHVkZTogeyBsZXZlbDogdHJ1ZSB9XHJcbiAgICB9KVxyXG5cclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdVc3VhcmlvIG5vIGVuY29udHJhZG8nIH1cclxuICAgIH1cclxuICAgIGlmICghdXNlci5sZXZlbCkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdFbCB1c3VhcmlvIG5vIHRpZW5lIG5pdmVsIGFzaWduYWRvJyB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgbmV4dExldmVsID0gYXdhaXQgcHJpc21hLmxldmVsLmZpbmRGaXJzdCh7XHJcbiAgICAgIHdoZXJlOiB7IFxyXG4gICAgICAgIG9yZGVyOiB1c2VyLmxldmVsIS5vcmRlciArIDFcclxuICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICBpZiAoIW5leHRMZXZlbCkge1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdObyBoYXkgc2lndWllbnRlIG5pdmVsIGRpc3BvbmlibGUnIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyBTdGFydCB0cmFuc2FjdGlvblxyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcHJpc21hLiR0cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcclxuICAgICAgLy8gVXBkYXRlIHVzZXIgbGV2ZWxcclxuICAgICAgY29uc3QgdXBkYXRlZFVzZXIgPSBhd2FpdCB0eC51c2VyLnVwZGF0ZSh7XHJcbiAgICAgICAgd2hlcmU6IHsgaWQ6IHVzZXJJZCB9LFxyXG4gICAgICAgIGRhdGE6IHsgbGV2ZWxJZDogbmV4dExldmVsLmlkIH0sXHJcbiAgICAgICAgaW5jbHVkZTogeyBsZXZlbDogdHJ1ZSB9XHJcbiAgICAgIH0pXHJcblxyXG4gICAgICAvLyBDcmVhdGUgcHJvbW90aW9uIHJlY29yZFxyXG4gICAgICBhd2FpdCB0eC5wcm9tb3Rpb24uY3JlYXRlKHtcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICB1c2VySWQsXHJcbiAgICAgICAgICBmcm9tTGV2ZWxJZDogdXNlci5sZXZlbCEuaWQsXHJcbiAgICAgICAgICB0b0xldmVsSWQ6IG5leHRMZXZlbC5pZCxcclxuICAgICAgICAgIHJlYXNvbjogJ1Byb21vY2nDs24gYXV0b23DoXRpY2EnLFxyXG4gICAgICAgICAgbWV0YWRhdGE6IHtcclxuICAgICAgICAgICAgZGlyZWN0UmVmZXJyYWxzOiBldmFsdWF0aW9uLmRpcmVjdFJlZmVycmFscyxcclxuICAgICAgICAgICAgdmFsaWRTdHJ1Y3R1cmU6IHRydWVcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcblxyXG4gICAgICByZXR1cm4gdXBkYXRlZFVzZXJcclxuICAgIH0pXHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgbmV3TGV2ZWw6IHJlc3VsdC5sZXZlbFxyXG4gICAgfVxyXG5cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgcHJvbW90aW5nIHVzZXI6JywgZXJyb3IpXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgZXJyb3I6ICdFcnJvciBpbnRlcm5vIGRlbCBzZXJ2aWRvcidcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBSZWdpc3RlciBhIG5ldyByZWZlcnJhbCBhbmQgY2hlY2sgZm9yIGF1dG9tYXRpYyBwcm9tb3Rpb25cclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZWdpc3RlclJlZmVycmFsQW5kRXZhbHVhdGUocmVmZXJyZXJJZDogc3RyaW5nLCByZWZlcnJlZFVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTx7XHJcbiAgc3VjY2VzczogYm9vbGVhblxyXG4gIHJlZmVycmFsQ3JlYXRlZDogYm9vbGVhblxyXG4gIHByb21vdGlvbkV2YWx1YXRlZDogYm9vbGVhblxyXG4gIHByb21vdGVkPzogYm9vbGVhblxyXG4gIG5ld0xldmVsPzogYW55XHJcbiAgZXJyb3I/OiBzdHJpbmdcclxufT4ge1xyXG4gIHRyeSB7XHJcbiAgICAvLyBDcmVhdGUgcmVmZXJyYWwgcmVjb3JkXHJcbiAgICBjb25zdCByZWZlcnJhbCA9IGF3YWl0IHByaXNtYS5yZWZlcnJhbC5jcmVhdGUoe1xyXG4gICAgICBkYXRhOiB7XHJcbiAgICAgICAgcmVmZXJyZXJJZCxcclxuICAgICAgICByZWZlcnJlZElkOiByZWZlcnJlZFVzZXJJZCxcclxuICAgICAgICBsZXZlbDogMSxcclxuICAgICAgICBjb21taXNzaW9uOiAwLCAvLyBXaWxsIGJlIGNhbGN1bGF0ZWQgYmFzZWQgb24gbGV2ZWxcclxuICAgICAgICBzdGF0dXM6ICdBUFBST1ZFRCdcclxuICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICAvLyBFdmFsdWF0ZSBpZiByZWZlcnJlciBjYW4gYmUgcHJvbW90ZWRcclxuICAgIGNvbnN0IGV2YWx1YXRpb24gPSBhd2FpdCBldmFsdWF0ZVVzZXJQcm9tb3Rpb24ocmVmZXJyZXJJZClcclxuICAgIGxldCBwcm9tb3Rpb25SZXN1bHQgPSBudWxsXHJcblxyXG4gICAgaWYgKGV2YWx1YXRpb24uY2FuUHJvbW90ZSkge1xyXG4gICAgICBwcm9tb3Rpb25SZXN1bHQgPSBhd2FpdCBwcm9tb3RlVXNlcihyZWZlcnJlcklkKVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgIHJlZmVycmFsQ3JlYXRlZDogdHJ1ZSxcclxuICAgICAgcHJvbW90aW9uRXZhbHVhdGVkOiB0cnVlLFxyXG4gICAgICBwcm9tb3RlZDogcHJvbW90aW9uUmVzdWx0Py5zdWNjZXNzIHx8IGZhbHNlLFxyXG4gICAgICBuZXdMZXZlbDogcHJvbW90aW9uUmVzdWx0Py5uZXdMZXZlbFxyXG4gICAgfVxyXG5cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgcmVnaXN0ZXJpbmcgcmVmZXJyYWwgYW5kIGV2YWx1YXRpbmcgcHJvbW90aW9uOicsIGVycm9yKVxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgIHJlZmVycmFsQ3JlYXRlZDogZmFsc2UsXHJcbiAgICAgIHByb21vdGlvbkV2YWx1YXRlZDogZmFsc2UsXHJcbiAgICAgIGVycm9yOiAnRXJyb3IgaW50ZXJubyBkZWwgc2Vydmlkb3InXHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogR2V0IHVzZXIncyBjdXJyZW50IGxldmVsIGluZm8gd2l0aCBwcm9ncmVzc1xyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFVzZXJMZXZlbEluZm8odXNlcklkOiBzdHJpbmcpIHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xyXG4gICAgICB3aGVyZTogeyBpZDogdXNlcklkIH0sXHJcbiAgICAgIGluY2x1ZGU6IHsgXHJcbiAgICAgICAgbGV2ZWw6IHRydWUsXHJcbiAgICAgICAgcHJvbW90aW9uSGlzdG9yeToge1xyXG4gICAgICAgICAgb3JkZXJCeTogeyBjcmVhdGVkQXQ6ICdkZXNjJyB9LFxyXG4gICAgICAgICAgdGFrZTogNVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICBpZiAoIXVzZXIpIHJldHVybiBudWxsXHJcbiAgICBpZiAoIXVzZXIubGV2ZWwpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdFbCB1c3VhcmlvIG5vIHRpZW5lIG5pdmVsIGFzaWduYWRvJylcclxuICAgIH1cclxuICAgIFxyXG4gICAgY29uc3QgZXZhbHVhdGlvbiA9IGF3YWl0IGV2YWx1YXRlVXNlclByb21vdGlvbih1c2VySWQpXHJcbiAgICBcclxuICAgIGNvbnN0IG5leHRMZXZlbCA9IGF3YWl0IHByaXNtYS5sZXZlbC5maW5kRmlyc3Qoe1xyXG4gICAgICB3aGVyZTogeyBcclxuICAgICAgICBvcmRlcjogdXNlci5sZXZlbCEub3JkZXIgKyAxXHJcbiAgICAgIH1cclxuICAgIH0pXHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgY3VycmVudExldmVsOiB1c2VyLmxldmVsISxcclxuICAgICAgbmV4dExldmVsLFxyXG4gICAgICBldmFsdWF0aW9uLFxyXG4gICAgICBwcm9tb3Rpb25IaXN0b3J5OiB1c2VyLnByb21vdGlvbkhpc3RvcnksXHJcbiAgICAgIGNhblByb21vdGU6IGV2YWx1YXRpb24uY2FuUHJvbW90ZVxyXG4gICAgfVxyXG5cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2V0dGluZyB1c2VyIGxldmVsIGluZm86JywgZXJyb3IpXHJcbiAgICByZXR1cm4gbnVsbFxyXG4gIH1cclxufSAiXSwibmFtZXMiOlsiUHJpc21hQ2xpZW50IiwicHJpc21hIiwiZ2V0RGlyZWN0UmVmZXJyYWxzIiwidXNlcklkIiwicmVmZXJyYWxzIiwidXNlciIsImZpbmRNYW55Iiwid2hlcmUiLCJyZWZlcnJlZEJ5IiwiaXNBY3RpdmUiLCJpbmNsdWRlIiwibGV2ZWwiLCJzZWxlY3QiLCJpZCIsIm9yZGVyQnkiLCJjcmVhdGVkQXQiLCJtYXAiLCJyZWZlcnJhbENvdW50IiwibGVuZ3RoIiwiZXJyb3IiLCJjb25zb2xlIiwiaGFzVGhyZWVSZWZlcnJhbHNFYWNoIiwiZmlyc3RUaHJlZVJlZmVycmFscyIsInNsaWNlIiwicmVmZXJyYWwiLCJjb3VudCIsImdldFVzZXJSZWZlcnJhbFN0cnVjdHVyZSIsIm1heERlcHRoIiwiZmluZFVuaXF1ZSIsIkVycm9yIiwiZGlyZWN0UmVmZXJyYWxzIiwiZ2V0RGlyZWN0UmVmZXJyYWxzUmVjdXJzaXZlIiwibmFtZSIsImVtYWlsIiwib3JkZXIiLCJjb2xvciIsImljb24iLCJqb2luRGF0ZSIsImRlcHRoIiwicmVzdWx0IiwiY2hpbGRSZWZlcnJhbHMiLCJwdXNoIiwiZXZhbHVhdGVVc2VyUHJvbW90aW9uIiwiZGlyZWN0UmVmZXJyYWxzQ291bnQiLCJjYW5Qcm9tb3RlIiwiY3VycmVudExldmVsIiwidmFsaWRTZWNvbmRMZXZlbFJlZmVycmFscyIsInJlcXVpcmVkU3RydWN0dXJlIiwibWlzc2luZ1JlcXVpcmVtZW50cyIsImhhc1ZhbGlkU3RydWN0dXJlIiwiZmlyc3RUaHJlZSIsInZhbGlkQ291bnQiLCJpIiwibmV4dExldmVsIiwiZmluZEZpcnN0IiwicHJvbW90ZVVzZXIiLCJldmFsdWF0aW9uIiwic3VjY2VzcyIsImpvaW4iLCIkdHJhbnNhY3Rpb24iLCJ0eCIsInVwZGF0ZWRVc2VyIiwidXBkYXRlIiwiZGF0YSIsImxldmVsSWQiLCJwcm9tb3Rpb24iLCJjcmVhdGUiLCJmcm9tTGV2ZWxJZCIsInRvTGV2ZWxJZCIsInJlYXNvbiIsIm1ldGFkYXRhIiwidmFsaWRTdHJ1Y3R1cmUiLCJuZXdMZXZlbCIsInJlZ2lzdGVyUmVmZXJyYWxBbmRFdmFsdWF0ZSIsInJlZmVycmVySWQiLCJyZWZlcnJlZFVzZXJJZCIsInJlZmVycmVkSWQiLCJjb21taXNzaW9uIiwic3RhdHVzIiwicHJvbW90aW9uUmVzdWx0IiwicmVmZXJyYWxDcmVhdGVkIiwicHJvbW90aW9uRXZhbHVhdGVkIiwicHJvbW90ZWQiLCJnZXRVc2VyTGV2ZWxJbmZvIiwicHJvbW90aW9uSGlzdG9yeSIsInRha2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/multilevel-system.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/prisma.ts":
/*!***************************!*\
  !*** ./src/lib/prisma.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   prisma: () => (/* binding */ prisma)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\n// Prevent multiple instances in development\nconst globalForPrisma = global;\nconst prisma = globalForPrisma.prisma || new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient({\n    log: [\n        \"error\"\n    ]\n});\nif (true) globalForPrisma.prisma = prisma;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3ByaXNtYS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBNkM7QUFFN0MsNENBQTRDO0FBQzVDLE1BQU1DLGtCQUFrQkM7QUFFakIsTUFBTUMsU0FDWEYsZ0JBQWdCRSxNQUFNLElBQ3RCLElBQUlILHdEQUFZQSxDQUFDO0lBQ2ZJLEtBQUs7UUFBQztLQUFRO0FBQ2hCLEdBQUU7QUFFSixJQUFJQyxJQUF5QixFQUFjSixnQkFBZ0JFLE1BQU0sR0FBR0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ncnVwb3Zpc2lvbmFyaW9zLy4vc3JjL2xpYi9wcmlzbWEudHM/MDFkNyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcmlzbWFDbGllbnQgfSBmcm9tICdAcHJpc21hL2NsaWVudCdcclxuXHJcbi8vIFByZXZlbnQgbXVsdGlwbGUgaW5zdGFuY2VzIGluIGRldmVsb3BtZW50XHJcbmNvbnN0IGdsb2JhbEZvclByaXNtYSA9IGdsb2JhbCBhcyB1bmtub3duIGFzIHsgcHJpc21hOiBQcmlzbWFDbGllbnQgfVxyXG5cclxuZXhwb3J0IGNvbnN0IHByaXNtYSA9XHJcbiAgZ2xvYmFsRm9yUHJpc21hLnByaXNtYSB8fFxyXG4gIG5ldyBQcmlzbWFDbGllbnQoe1xyXG4gICAgbG9nOiBbJ2Vycm9yJ11cclxuICB9KVxyXG5cclxuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIGdsb2JhbEZvclByaXNtYS5wcmlzbWEgPSBwcmlzbWEgIl0sIm5hbWVzIjpbIlByaXNtYUNsaWVudCIsImdsb2JhbEZvclByaXNtYSIsImdsb2JhbCIsInByaXNtYSIsImxvZyIsInByb2Nlc3MiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/prisma.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/next-auth","vendor-chunks/@babel","vendor-chunks/jose","vendor-chunks/openid-client","vendor-chunks/bcryptjs","vendor-chunks/oauth","vendor-chunks/object-hash","vendor-chunks/preact","vendor-chunks/uuid","vendor-chunks/@next-auth","vendor-chunks/yallist","vendor-chunks/preact-render-to-string","vendor-chunks/lru-cache","vendor-chunks/cookie","vendor-chunks/oidc-token-hash","vendor-chunks/@panva"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fuser%2F%5Bid%5D%2Fstructure%2Froute&page=%2Fapi%2Fuser%2F%5Bid%5D%2Fstructure%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fuser%2F%5Bid%5D%2Fstructure%2Froute.ts&appDir=C%3A%5Cgrupo-visionarios%5Cgrupovisionarios%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5Cgrupo-visionarios%5Cgrupovisionarios&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();